{"ast":null,"code":"!function (e, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t(require(\"react\")) : \"function\" == typeof define && define.amd ? define([\"react\"], t) : (e = e || self).Collapse = t(e.React);\n}(this, function (e) {\n  \"use strict\";\n\n  var t = \"default\" in e ? e.default : e;\n\n  function n(e, t, n) {\n    return t in e ? Object.defineProperty(e, t, {\n      value: n,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }) : e[t] = n, e;\n  }\n\n  function r() {\n    return (r = Object.assign || function (e) {\n      for (var t = 1; t < arguments.length; t++) {\n        var n = arguments[t];\n\n        for (var r in n) Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r]);\n      }\n\n      return e;\n    }).apply(this, arguments);\n  }\n\n  function o(e, t) {\n    var n = Object.keys(e);\n\n    if (Object.getOwnPropertySymbols) {\n      var r = Object.getOwnPropertySymbols(e);\n      t && (r = r.filter(function (t) {\n        return Object.getOwnPropertyDescriptor(e, t).enumerable;\n      })), n.push.apply(n, r);\n    }\n\n    return n;\n  }\n\n  function i(e) {\n    for (var t = 1; t < arguments.length; t++) {\n      var r = null != arguments[t] ? arguments[t] : {};\n      t % 2 ? o(Object(r), !0).forEach(function (t) {\n        n(e, t, r[t]);\n      }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r)) : o(Object(r)).forEach(function (t) {\n        Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));\n      });\n    }\n\n    return e;\n  }\n\n  function a(e, t) {\n    if (null == e) return {};\n\n    var n,\n        r,\n        o = function (e, t) {\n      if (null == e) return {};\n      var n,\n          r,\n          o = {},\n          i = Object.keys(e);\n\n      for (r = 0; r < i.length; r++) n = i[r], t.indexOf(n) >= 0 || (o[n] = e[n]);\n\n      return o;\n    }(e, t);\n\n    if (Object.getOwnPropertySymbols) {\n      var i = Object.getOwnPropertySymbols(e);\n\n      for (r = 0; r < i.length; r++) n = i[r], t.indexOf(n) >= 0 || Object.prototype.propertyIsEnumerable.call(e, n) && (o[n] = e[n]);\n    }\n\n    return o;\n  }\n\n  function c(e, t) {\n    return function (e) {\n      if (Array.isArray(e)) return e;\n    }(e) || function (e, t) {\n      if (\"undefined\" == typeof Symbol || !(Symbol.iterator in Object(e))) return;\n      var n = [],\n          r = !0,\n          o = !1,\n          i = void 0;\n\n      try {\n        for (var a, c = e[Symbol.iterator](); !(r = (a = c.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);\n      } catch (e) {\n        o = !0, i = e;\n      } finally {\n        try {\n          r || null == c.return || c.return();\n        } finally {\n          if (o) throw i;\n        }\n      }\n\n      return n;\n    }(e, t) || function (e, t) {\n      if (!e) return;\n      if (\"string\" == typeof e) return l(e, t);\n      var n = Object.prototype.toString.call(e).slice(8, -1);\n      \"Object\" === n && e.constructor && (n = e.constructor.name);\n      if (\"Map\" === n || \"Set\" === n) return Array.from(n);\n      if (\"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return l(e, t);\n    }(e, t) || function () {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }();\n  }\n\n  function l(e, t) {\n    (null == t || t > e.length) && (t = e.length);\n\n    for (var n = 0, r = new Array(t); n < t; n++) r[n] = e[n];\n\n    return r;\n  }\n\n  function u(e) {\n    requestAnimationFrame(function () {\n      requestAnimationFrame(e);\n    });\n  }\n\n  return function (n) {\n    var o = n.children,\n        l = n.transition,\n        s = n.style,\n        f = n.render,\n        p = n.elementType,\n        y = void 0 === p ? \"div\" : p,\n        d = n.isOpen,\n        b = n.collapseHeight,\n        h = void 0 === b ? \"0px\" : b,\n        g = n.onInit,\n        v = n.onChange,\n        m = n.className,\n        O = void 0 === m ? \"collapse-css-transition\" : m,\n        j = n.addState,\n        w = n.noAnim,\n        x = n.overflowOnExpanded,\n        S = a(n, [\"children\", \"transition\", \"style\", \"render\", \"elementType\", \"isOpen\", \"collapseHeight\", \"onInit\", \"onChange\", \"className\", \"addState\", \"noAnim\", \"overflowOnExpanded\"]),\n        P = function () {\n      return \"0px\" === h ? \"hidden\" : \"\";\n    },\n        A = c(e.useReducer(function (e) {\n      return e + 1;\n    }, 0), 2),\n        E = (A[0], A[1]),\n        D = e.useRef(),\n        I = c(e.useState(0), 2),\n        T = I[0],\n        C = I[1],\n        k = e.useRef({\n      collapse: d ? \"expanded\" : \"collapsed\",\n      style: {\n        height: d ? \"\" : h,\n        visibility: d ? \"\" : P()\n      }\n    }).current;\n\n    e.useEffect(function () {\n      T && N(v);\n    }, [T]);\n\n    var N = function (e) {\n      var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n      e && (e.name, e(i({\n        state: k.collapse,\n        style: k.style\n      }, t)));\n    };\n\n    function R() {\n      D.current && (k.collapse = \"collapsed\", k.style = {\n        height: h,\n        visibility: P()\n      }, E(), setTimeout(function () {\n        return C(Date.now);\n      }, 0));\n    }\n\n    function q() {\n      D.current && (k.collapse = \"expanded\", k.style = {\n        height: \"\",\n        visibility: \"\"\n      }, E(), setTimeout(function () {\n        return C(Date.now);\n      }, 0));\n    }\n\n    function H() {\n      return \"\".concat(D.current.scrollHeight, \"px\");\n    }\n\n    var F = \"expanded\" === k.collapse || \"expanding\" === k.collapse;\n    !F && d && function () {\n      if (D.current) {\n        if (w) return q();\n        k.collapse = \"expanding\", u(function () {\n          D.current && \"expanding\" === k.collapse && (k.style = {\n            height: H(),\n            visibility: \"\"\n          }, C(Date.now));\n        });\n      }\n    }(), F && !d && function () {\n      if (D.current) {\n        if (w) return R();\n        k.collapse = \"collapsing\", k.style = {\n          height: H(),\n          visibility: \"\"\n        }, E(), u(function () {\n          D.current && \"collapsing\" === k.collapse && (k.style = {\n            height: h,\n            visibility: \"\"\n          }, C(Date.now));\n        });\n      }\n    }();\n    var M = i({\n      overflow: \"expanded\" === k.collapse && x ? \"\" : \"hidden\",\n      transition: l\n    }, s, {}, k.style),\n        U = y,\n        $ = e.useCallback(function (e) {\n      e && (D.current = e, N(g, {\n        node: e\n      }));\n    }, [y]),\n        z = j ? \"\".concat(O, \" --c-\").concat(k.collapse) : O;\n    return t.createElement(U, r({\n      ref: $,\n      style: M,\n      onTransitionEnd: function (e) {\n        var t = e.target,\n            n = e.propertyName;\n\n        if (t === D.current && \"height\" === n) {\n          var r = t.style.height;\n\n          switch (k.collapse, k.collapse) {\n            case \"expanding\":\n              \"\" === r || r === h || q();\n              break;\n\n            case \"collapsing\":\n              \"\" === r || r !== h || R();\n          }\n        }\n      },\n      className: z\n    }, S), \"function\" == typeof o ? o(k.collapse) : \"function\" == typeof f ? f(k.collapse) : o);\n  };\n});","map":{"version":3,"sources":["../src/components/collapse/Collapse.jsx"],"names":["nextFrame","callback","requestAnimationFrame","children","transition","style","render","elementType","isOpen","collapseHeight","onInit","onChange","className","addState","noAnim","overflowOnExpanded","rest","getCollapsedVisibility","forceUpdate","useReducer","_","elementRef","useRef","callbackTick","setCallbackTick","useState","state","collapse","height","visibility","current","useEffect","onCallback","params","name","setCollapsed","setTimeout","Date","now","getElementHeight","setExpanded","scrollHeight","target","propertyName","styleHeight","didOpen","setExpanding","setCollapsing","computedStyle","overflow","ElementType","callbackRef","useCallback","node","collapseClassName","React","ref","onTransitionEnd"],"mappings":"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","sourcesContent":["/* eslint-env browser */\r\n\r\n/**\r\n * All debug logs are removed on build\r\n */\r\n\r\nimport \"./collapse.css\";\r\nimport React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useReducer\r\n} from \"react\";\r\nimport debugLog from \"./debugLog\";\r\n\r\n// using let instead of const,\r\n// experimenting with ES2015 bundle which gets a bit smaller when using let over const.\r\nlet COLLAPSED = \"collapsed\";\r\nlet COLLAPSING = \"collapsing\";\r\nlet EXPANDING = \"expanding\";\r\nlet EXPANDED = \"expanded\";\r\n\r\nlet defaultClassName = \"collapse-css-transition\";\r\nlet defaultElementType = \"div\";\r\nlet defaultCollapseHeight = \"0px\";\r\n\r\n/**\r\n *\r\n * @param {function} callback\r\n */\r\nfunction nextFrame(callback) {\r\n  requestAnimationFrame(function() {\r\n    //setTimeout(callback, 0); // NOT used because can be jumpy if click-spamming.\r\n    requestAnimationFrame(callback); // This is used.\r\n  });\r\n}\r\n\r\nfunction Collapse({\r\n  children,\r\n  transition,\r\n  style,\r\n  render,\r\n  elementType = defaultElementType,\r\n  isOpen,\r\n  collapseHeight = defaultCollapseHeight,\r\n  onInit,\r\n  onChange,\r\n  className = defaultClassName,\r\n  addState,\r\n  noAnim,\r\n  overflowOnExpanded,\r\n  ...rest\r\n}) {\r\n  let getCollapsedVisibility = () => (collapseHeight === \"0px\" ? \"hidden\" : \"\");\r\n\r\n  let [__, forceUpdate] = useReducer(_ => _ + 1, 0);\r\n\r\n  let elementRef = useRef();\r\n  let [callbackTick, setCallbackTick] = useState(0);\r\n\r\n  // Avoiding setState to control when stuff are updated.\r\n  // Might not be needed.\r\n  let state = useRef({\r\n    collapse: isOpen ? EXPANDED : COLLAPSED,\r\n    style: {\r\n      height: isOpen ? \"\" : collapseHeight,\r\n      visibility: isOpen ? \"\" : getCollapsedVisibility()\r\n    }\r\n  }).current;\r\n\r\n  useEffect(() => {\r\n    // Invoke callback when data are updated, use Effect to sync state.\r\n    callbackTick && onCallback(onChange);\r\n  }, [callbackTick]);\r\n\r\n  /**\r\n   *\r\n   * @param {function} callback\r\n   */\r\n  let onCallback = (callback, params = {}) => {\r\n    if (callback) {\r\n      debugLog(\"onCallback \" + callback.name);\r\n      callback({ state: state.collapse, style: state.style, ...params });\r\n    }\r\n  };\r\n\r\n  function setCollapsed() {\r\n    if (!elementRef.current) return; // might be redundant\r\n\r\n    // Update state\r\n    state.collapse = COLLAPSED;\r\n\r\n    debugLog(\"setCollapsed\");\r\n\r\n    state.style = {\r\n      height: collapseHeight,\r\n      visibility: getCollapsedVisibility()\r\n    };\r\n    forceUpdate();\r\n\r\n    setTimeout(() => setCallbackTick(Date.now), 0); // callback and re-render\r\n  }\r\n\r\n  function setCollapsing() {\r\n    if (!elementRef.current) return; // might be redundant\r\n\r\n    if (noAnim) {\r\n      return setCollapsed();\r\n    }\r\n\r\n    // Update state\r\n    state.collapse = COLLAPSING;\r\n\r\n    debugLog(\"setCollapsing\");\r\n\r\n    state.style = {\r\n      height: getElementHeight(),\r\n      visibility: \"\"\r\n    };\r\n    forceUpdate();\r\n\r\n    nextFrame(() => {\r\n      if (!elementRef.current) return;\r\n      if (state.collapse !== COLLAPSING) return;\r\n\r\n      state.style = {\r\n        height: collapseHeight,\r\n        visibility: \"\"\r\n      };\r\n      //forceUpdate();\r\n\r\n      setCallbackTick(Date.now); // callback and re-render\r\n    });\r\n  }\r\n\r\n  function setExpanding() {\r\n    if (!elementRef.current) return; // might be redundant\r\n\r\n    if (noAnim) {\r\n      return setExpanded();\r\n    }\r\n\r\n    // Updatetate\r\n    state.collapse = EXPANDING;\r\n\r\n    debugLog(\"setExpanding\");\r\n\r\n    nextFrame(() => {\r\n      if (!elementRef.current) return; // might be redundant\r\n      if (state.collapse !== EXPANDING) return;\r\n\r\n      state.style = {\r\n        height: getElementHeight(),\r\n        visibility: \"\"\r\n      };\r\n      // forceUpdate();\r\n\r\n      setCallbackTick(Date.now); // callback and re-render\r\n    });\r\n  }\r\n\r\n  function setExpanded() {\r\n    if (!elementRef.current) return; // might be redundant\r\n\r\n    // Update state\r\n    state.collapse = EXPANDED;\r\n\r\n    debugLog(\"setExpanded\");\r\n\r\n    state.style = {\r\n      height: \"\",\r\n      visibility: \"\"\r\n    };\r\n    forceUpdate();\r\n\r\n    setTimeout(() => setCallbackTick(Date.now), 0); // callback and re-render\r\n  }\r\n\r\n  function getElementHeight() {\r\n    // @ts-ignore\r\n    return `${elementRef.current.scrollHeight}px`;\r\n  }\r\n\r\n  function onTransitionEnd({ target, propertyName }) {\r\n    if (target === elementRef.current && propertyName === \"height\") {\r\n      let styleHeight = target.style.height;\r\n\r\n      debugLog(\"onTransitionEnd\", state.collapse, propertyName, styleHeight);\r\n\r\n      switch (state.collapse) {\r\n        case EXPANDING:\r\n          if (styleHeight === \"\" || styleHeight === collapseHeight)\r\n            // This is stale, a newer event has happened before this could execute\r\n            console.warn(\r\n              `onTransitionEnd height unexpected ${styleHeight}`,\r\n              \"ignore setExpanded\"\r\n            );\r\n          else setExpanded();\r\n          break;\r\n        case COLLAPSING:\r\n          if (styleHeight === \"\" || styleHeight !== collapseHeight)\r\n            // This is stale, a newer event has happened before this could execute\r\n            console.warn(\r\n              `onTransitionEnd height unexpected ${styleHeight}`,\r\n              \"ignore setCollapsed\"\r\n            );\r\n          else setCollapsed();\r\n          break;\r\n        default:\r\n          console.warn(\"Ignored in onTransitionEnd\", state.collapse);\r\n      }\r\n    }\r\n  }\r\n\r\n  // getDerivedStateFromProps\r\n  let didOpen = state.collapse === EXPANDED || state.collapse === EXPANDING;\r\n\r\n  if (!didOpen && isOpen) setExpanding();\r\n\r\n  if (didOpen && !isOpen) setCollapsing();\r\n  // END getDerivedStateFromProps\r\n\r\n  let overflow =\r\n    state.collapse === EXPANDED && overflowOnExpanded ? \"\" : \"hidden\";\r\n\r\n  let computedStyle = {\r\n    overflow,\r\n    transition,\r\n    ...style,\r\n    ...state.style\r\n  };\r\n  let ElementType = elementType;\r\n\r\n  let callbackRef = useCallback(\r\n    node => {\r\n      if (node) {\r\n        elementRef.current = node;\r\n        onCallback(onInit, { node });\r\n        debugLog(\"callback ref\");\r\n      }\r\n    },\r\n    [elementType]\r\n  );\r\n\r\n  let collapseClassName = addState\r\n    ? `${className} --c-${state.collapse}`\r\n    : className;\r\n\r\n  debugLog(\"Render\");\r\n\r\n  return (\r\n    <ElementType\r\n      ref={callbackRef}\r\n      style={computedStyle}\r\n      onTransitionEnd={onTransitionEnd}\r\n      className={collapseClassName}\r\n      {...rest}\r\n    >\r\n      {typeof children === \"function\"\r\n        ? children(state.collapse)\r\n        : typeof render === \"function\"\r\n        ? render(state.collapse)\r\n        : children}\r\n    </ElementType>\r\n  );\r\n}\r\n\r\nexport default Collapse;\r\n"]},"metadata":{},"sourceType":"script"}